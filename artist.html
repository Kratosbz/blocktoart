<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Artist</title>

<link rel="stylesheet" href="style.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<link rel="stylesheet" href="./footer.css">

</head>
<body>

<header class="navbar">
  <div class="nav-left">
    <div class="logo">▣</div>
    <a href="#">Explore</a>
    <a href="#">Resources</a>
  </div>
<style>

  /* ================= GRID ================= */

.contentGrid {
  max-width: 1200px;
  margin: 40px auto;
  padding: 0 40px;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
  gap: 30px;
}

/* ================= CARD ================= */

.artworkCard {
  background: white;
  border-radius: 16px;
  overflow: hidden;
  cursor: pointer;
  transition: 0.25s ease;
  box-shadow: 0 4px 18px rgba(0,0,0,0.06);
}

.artworkCard:hover {
  transform: translateY(-6px);
  box-shadow: 0 14px 30px rgba(0,0,0,0.12);
}

.artworkImage {
  width: 100%;
  height: 240px;
  background-size: cover;
  background-position: center;
}

.artworkDetails {
  padding: 16px;
}

.artworkTitle {
  font-weight: 600;
  margin-bottom: 8px;
}

.artworkPrice {
  color: #5a54f9;
  font-weight: 500;
}

/* ================= ERROR STATE ================= */

.centerMessage {
  text-align: center;
  padding: 80px 20px;
}

.backBtn {
  display: inline-block;
  margin-top: 20px;
  padding: 12px 24px;
  background: linear-gradient(135deg,#6c63ff,#5a54f9);
  color: white;
  border-radius: 10px;
  text-decoration: none;
}


  * {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Inter', sans-serif;
  background: #f6f7f9;
  color: #1d1f23;
}

/* ================= NAVBAR ================= */

.navbar {
  height: 72px;
  background: white;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 60px;
  border-bottom: 1px solid #eee;
}

.nav-left {
  display: flex;
  align-items: center;
  gap: 30px;
}

.logo {
  width: 42px;
  height: 42px;
  background: #111;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
}

.nav-left a {
  text-decoration: none;
  color: #333;
  font-weight: 500;
}

.nav-search {
  position: relative;
}

.nav-search input {
  width: 420px;
  height: 44px;
  border-radius: 22px;
  border: 1px solid #e2e4e8;
  padding: 0 100px 0 20px;
  background: #f8f9fb;
}

.shortcut {
  position: absolute;
  right: 15px;
  top: 11px;
  font-size: 12px;
  color: #777;
}

.signin-btn {
  padding: 10px 22px;
  border-radius: 12px;
  border: none;
  font-weight: 600;
  background: linear-gradient(135deg, #6c63ff, #5a54f9);
  color: white;
  cursor: pointer;
}

/* ================= COVER ================= */

.cover {
  width: 100%;
  height: 260px;
  overflow: hidden;
}

.cover img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* ================= PROFILE ================= */

/* ================= DESKTOP PROFILE ================= */

.profileDesktop {
  max-width: 1400px;
  margin: -80px auto 0;
  padding: 0 80px 60px;
  position: relative;
}

.profileTopRow {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
}

/* LEFT SIDE */
.profileLeftActions {
  display: flex;
  gap: 18px;
  margin-top: 120px;
}

.actionBtn {
  background: transparent;
  border: none;
  font-size: 16px;
  color: #5f6368;
  cursor: pointer;
  font-weight: 500;
}

.iconBtn {
  background: transparent;
  border: none;
  font-size: 18px;
  cursor: pointer;
}

/* CENTER */
.profileCenter {
  text-align: center;
  max-width: 600px;
}

.avatarLarge {
  width: 130px;
  height: 130px;
  background: #111;
  border-radius: 50%;
  border: 6px solid white;
  margin: -65px auto 20px;
}

.profileName {
  font-size: 48px;
  font-weight: 600;
  margin-bottom: 20px;
}

.profileBio {
  font-size: 18px;
  color: #6b7280;
  line-height: 1.6;
  max-width: 520px;
  margin: 0 auto;
}

.moreLink {
  margin-top: 10px;
  background: none;
  border: none;
  color: #5a54f9;
  cursor: pointer;
  font-weight: 500;
}

.mainButtons {
  margin-top: 35px;
  display: flex;
  justify-content: center;
  gap: 20px;
}

.primaryBtn {
  padding: 16px 42px;
  border-radius: 16px;
  border: none;
  background: linear-gradient(135deg,#6c63ff,#5a54f9);
  color: white;
  font-weight: 600;
  font-size: 16px;
  box-shadow: 0 12px 28px rgba(92,84,249,0.35);
  cursor: pointer;
}

.secondaryBtn {
  padding: 16px 42px;
  border-radius: 16px;
  border: 1px solid #e5e7eb;
  background: #f3f4f6;
  font-weight: 500;
  font-size: 16px;
  color: #6b7280;
}

/* RIGHT SIDE */
.profileRightStats {
  display: flex;
  gap: 60px;
  margin-top: 120px;
}

.statBlock {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
}

.statLabel {
  font-size: 14px;
  color: #6b7280;
}

.statValue {
  font-size: 20px;
  font-weight: 600;
  margin-top: 6px;
}


/* ================= STATS ================= */

.stats {
  position: absolute;
  right: 60px;
  top: 40px;
  display: flex;
  gap: 60px;
}

.stats div {
  display: flex;
  flex-direction: column;
}

.number {
  font-size: 22px;
  font-weight: 600;
}

.label {
  font-size: 14px;
  color: #777;
}

/* ================= TABS ================= */

.tabs {
  margin-top: 60px;
  display: flex;
  justify-content: center;
  gap: 35px;
  font-size: 15px;
  border-bottom: 1px solid #e5e7eb;
  padding-bottom: 15px;
}

.tabs a {
  text-decoration: none;
  color: #555;
  padding-bottom: 8px;
  cursor: pointer;
}

.tabs .active {
  border-bottom: 3px solid #111;
  color: #111;
  font-weight: 600;
}

/* ================= MOBILE ================= */

@media (max-width: 768px) {

  .navbar {
    padding: 0 20px;
  }

  .nav-search {
    display: none;
  }

  .profile {
    flex-direction: column;
    padding: 0 20px 40px;
  }

  .stats {
    position: static;
    margin-top: 30px;
    justify-content: center;
    gap: 40px;
  }

  .username {
    font-size: 28px;
  }

  .avatar {
    width: 100px;
    height: 100px;
    top: -50px;
  }

  .buttons {
    flex-direction: column;
    gap: 15px;
  }

  .tabs {
    overflow-x: auto;
    justify-content: flex-start;
    padding-left: 20px;
  }

}
/* ================= TABLET ================= */

@media (max-width: 1100px) {

  .profileTopRow {
    flex-direction: column;
    align-items: center;
  }

  .profileLeftActions {
    margin-top: 30px;
    order: 2;
  }

  .profileRightStats {
    margin-top: 40px;
    order: 3;
    justify-content: center;
  }

  .profileCenter {
    order: 1;
  }

}


/* ================= MOBILE ================= */

@media (max-width: 768px) {

  .profileDesktop {
    padding: 0 20px 50px;
  }

  .profileTopRow {
    flex-direction: column;
    align-items: center;
  }

  /* Avatar smaller */
  .avatarLarge {
    width: 100px;
    height: 100px;
    margin: -50px auto 15px;
  }

  /* Name smaller */
  .profileName {
    font-size: 28px;
  }

  /* Bio tighter */
  .profileBio {
    font-size: 15px;
    padding: 0 10px;
  }

  /* Buttons stack */
  .mainButtons {
    flex-direction: column;
    width: 100%;
  }

  .primaryBtn,
  .secondaryBtn {
    width: 100%;
  }

  /* Left actions centered */
  .profileLeftActions {
    justify-content: center;
    flex-wrap: wrap;
    gap: 12px;
  }

  /* Stats stacked */
  .profileRightStats {
    flex-direction: column;
    align-items: center;
    gap: 20px;
  }

  .statBlock {
    align-items: center;
  }



}

/* ================= Tabs ================= */

.marketTabsWrapper {
  margin-top: 60px;
}

.marketTabs {
  display: flex;
  gap: 20px;
  border-bottom: 1px solid #eee;
  margin-bottom: 40px;
}

.marketTab {
  background: none;
  border: none;
  font-size: 16px;
  font-weight: 600;
  padding: 12px 0;
  cursor: pointer;
  color: #777;
  position: relative;
}

.marketTab.active {
  color: #111;
}

.marketTab.active::after {
  content: "";
  position: absolute;
  bottom: -1px;
  left: 0;
  width: 100%;
  height: 2px;
  background: #111;
}

/* ================= Panels ================= */
/* ================= MOBILE PROFILE (EXACT OPENSEA STYLE) ================= */
@media (max-width: 768px) {

  /* Main wrapper becomes card-like */
  .profileDesktop {
    margin-top: -60px;
    padding: 0 16px 40px;
  }

  .profileTopRow {
    flex-direction: column;
    align-items: center;
    text-align: center;
    background: #fff;
    border-radius: 24px;
    padding: 24px 18px 28px;
    box-shadow: 0 6px 24px rgba(0,0,0,0.06);
  }

  /* Hide desktop side sections */
  .profileLeftActions {
    order: 2;
    margin-top: 10px;
    justify-content: center;
    gap: 16px;
  }

  .profileRightStats {
    order: 4;
    margin-top: 18px;
    flex-direction: row;
    justify-content: center;
    gap: 24px;
  }

  /* Avatar */
  .avatarLarge {
    width: 90px;
    height: 90px;
    margin: -45px auto 12px;
    border: 5px solid #fff;
  }

  /* Name */
  .profileName {
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 10px;
  }

  /* Bio */
  .profileBio {
    font-size: 15px;
    color: #6b7280;
    line-height: 1.6;
    max-width: 320px;
    margin: 0 auto 8px;
  }

  /* Follow + Wallets row style */
  .profileLeftActions .actionBtn {
    font-size: 15px;
    color: #6b7280;
    font-weight: 500;
  }

  /* Stats like screenshot */
  .statBlock {
    align-items: center;
  }

  .statValue {
    font-size: 16px;
    font-weight: 600;
  }

  .statLabel {
    font-size: 13px;
    color: #9ca3af;
  }

  /* Buttons row */
  .mainButtons {
    order: 5;
    flex-direction: row;
    justify-content: center;
    gap: 14px;
    margin-top: 22px;
    width: 100%;
  }

  /* Shop button (purple gradient like screenshot) */
  .primaryBtn {
    flex: 1;
    max-width: 160px;
    padding: 14px 0;
    border-radius: 16px;
    font-size: 16px;
    box-shadow: 0 10px 24px rgba(92,84,249,0.35);
  }

  /* Exhibition button (light pill) */
  .secondaryBtn {
    flex: 1;
    max-width: 160px;
    padding: 14px 0;
    border-radius: 16px;
    background: #f3f4f6;
    border: 1px solid #e5e7eb;
    color: #374151;
    font-weight: 600;
  }

  /* Tabs spacing under card */
  .marketTabsWrapper {
    margin-top: 24px;
  }
}

.tabPanel {
  display: none;
}

.tabPanel.active {
  display: block;
}

/* ================= Card Grid ================= */

.cardGrid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 30px;
}

/* ================= Minimal Card ================= */

.simpleCard {
  border: 1px solid #eee;
  border-radius: 16px;
  padding: 20px;
  background: #fff;
  transition: 0.2s ease;
}

.simpleCard:hover {
  transform: translateY(-4px);
  box-shadow: 0 10px 25px rgba(0,0,0,0.05);
}

.cardTitle {
  font-weight: 600;
  font-size: 16px;
  margin-bottom: 10px;
}

.cardPrice {
  font-size: 14px;
  color: #555;
  margin-bottom: 6px;
}

.cardStatus {
  font-size: 13px;
  font-weight: 600;
}

.status-sale { color: #16a34a; }
.status-auction { color: #d97706; }
.status-sold { color: #777; }

/* ================= Responsive ================= */

@media (max-width: 1100px) {
  .cardGrid {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 768px) {
  .cardGrid {
    grid-template-columns: 1fr;
  }

  .marketTabs {
    gap: 12px;
  }
}


</style>
  <div class="nav-search">
    <input type="text" placeholder="Search">
    <span class="shortcut">Ctrl K</span>
  </div>

  <div class="nav-right">
    <button class="signin-btn">Sign in</button>
  </div>
</header>

<section class="cover" id="coverage" >
 
</section>

<!-- IMPORTANT: Script renders inside here -->
<div id="pageContent"></div>
  <!-- Footer -->
  <footer>
    <div class="container" style="max-width: 100%; padding: 0;">
      <div class="footer-header">
        <div class="footer-logo">
          <img src="https://ext.same-assets.com/1288399759/1188727251.svg" alt="Exchange.Art">
          <span class="footer-logo-text">Blockto<span>art</span></span>
        </div>
        <!-- <div class="theme-toggle">
          <div class="toggle-switch"></div>
          Dark
        </div> -->
      </div>
      <p class="footer-tagline">Collect & sell digital fine art</p>

      <div class="footer-links">
        <div class="footer-column">
          <h4>Marketplace</h4>
          <ul>
            <li><a href="./marketplace.html">Artworks</a></li>
            <li><a href="./allcollections.html">Collections</a></li>
            <!-- <li><a href="#">Series</a></li>
            <li><a href="#">Profiles</a></li>
            <li><a href="#">Leaderboards</a></li> -->
          </ul>
        </div>
        <div class="footer-column">
          <h4>Resources</h4>
          <ul>
            <!-- <li><a href="#">ArtDrop</a></li> -->
            <li><a href="#">Blog</a></li>
            <li><a href="./support.html">Helpdesk</a></li>
            <!-- <li><a href="#">Suggest a feature</a></li>
            <li><a href="#">Branding</a></li> -->
          </ul>
        </div>
        <div class="footer-column">
          <h4>Account</h4>
          <ul>
            <li><a href="./signup.html">Sign up</a></li>
            <li><a href="./login.html">Sign in</a></li>
            <!-- <li><a href="#">Legacy Sign In</a></li> -->
          </ul>
        </div>
        <div class="footer-column">
          <h4>Community</h4>
          <div class="social-links">
            <a href="#"><img src="https://ext.same-assets.com/1288399759/2388733996.svg" alt="X"></a>
            <a href="#"><img src="https://ext.same-assets.com/1288399759/1750959219.svg" alt="YouTube"></a>
            <a href="#"><img src="https://ext.same-assets.com/1288399759/2443148422.svg" alt="Instagram"></a>
          </div>
        </div>
      </div>

      <div class="footer-bottom">
        <span>Copyright 2026 EXCHANGE.ART, All rights reserved</span>
        <div class="footer-legal">
          <a href="#">Terms of service</a>
          <a href="#">Privacy policy</a>
        </div>
      </div>
    </div>
  </footer>

<script>
/* ================= GLOBAL ================= */
let artistName = '';
let username = '';
let artistNFTs = [];
let allNFTs = [];
let allCollections = [];
let collectionNFTImages = {};
let allAuctions = [];
let followers = '';
let following = '';
let volumeSold = '';
let artistMage=''

/* ================= DOM LOAD ================= */
document.addEventListener('DOMContentLoaded', async () => {
    const params = new URLSearchParams(window.location.search);
    artistName = decodeURIComponent(params.get('name') || '');
    username = artistName;

    if (!artistName) return showError("Artist not found");

    try {
        await loadArtistProfile();
        await loadCollections();
        await loadAuctions();
        setupTabs(); // activate tab switching
          renderCollections();
    } catch (err) {
        console.error(err);
        showError("Error loading page");
    }
});

/* ================= ERROR ================= */
function showError(message) {
    document.getElementById('pageContent').innerHTML = `
        <div class="centerMessage">
            <h4>${message}</h4>
            <a href="/index.html" class="backBtn">Back to Marketplace</a>
        </div>
    `;
}



async function loadArtistProfileAvatar() {
  try {
    const token = localStorage.getItem("token");
    if (!token) throw new Error("No token found");

    const params = new URLSearchParams(window.location.search);
    const username = params.get("name");

    if (!username) throw new Error("No username in URL");

    const res = await fetch(
      `https://changes-sample.onrender.com/api/user/avatar/${encodeURIComponent(username)}`,
      {
        method: "GET",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${token}`,
        },
      }
    );

    if (!res.ok) throw new Error("Failed to load avatar");

    const data = await res.json();
    const coverageEl = document.getElementById("coverage");
localStorage.setItem("artistId",data._id)
    if (!coverageEl) return;

    coverageEl.innerHTML = `
      <img 
        src="${data.profileImage || 'default-avatar.png'}" 
        alt="${username}" 
        class="artist-cover-img"
      >
    `;
  } catch (err) {
    console.error("Avatar load error:", err);
  }
}

/* ================= LOAD ARTIST NFTS ================= */
async function loadArtistProfile() {
    const res = await fetch('https://changes-sample.onrender.com/api/marketplace/nfts');
    if (!res.ok) throw new Error('Failed to fetch NFTs');
    allNFTs = await res.json();

    const creatorEmail = localStorage.getItem("creatorEmail");
    artistNFTs = allNFTs.filter(n => n.owner === creatorEmail);

    if (!artistNFTs.length) showError("No artworks found for this artist");
    renderProfile();
}

/* ================= RENDER PROFILE ================= */
function renderProfile() {
   var artistId=localStorage.getItem("artistId")
    document.getElementById("pageContent").innerHTML = `
<section class="profileDesktop">
    <div class="profileTopRow">
        <div class="profileLeftActions">
            <button class="actionBtn" id="followBtn">♡ Follow</button>
            <button class="actionBtn" id="exhibitionBtn">Exhibition</button>
            <button class="iconBtn">↗</button>
        </div>
        <div class="profileCenter">
            <div class="avatarLarge"></div>
            <h1 class="profileName">${artistName}</h1>
            <p class="profileBio">Artist on Blocktoart platform creating digital collectibles.</p>
            <div class="mainButtons">
                <button class="primaryBtn">Shop</button>
            </div>
        </div>
        <div class="profileRightStats">
            <div class="statBlock"><span class="statLabel">Followers</span><span class="statValue">${followers}</span></div>
            <div class="statBlock"><span class="statLabel">Following</span><span class="statValue">${following}</span></div>
            <div class="statBlock"><span class="statLabel">Volume sold</span><span class="statValue">${volumeSold}</span></div>
        </div>
    </div>

    <div class="marketTabsWrapper">
        <div class="marketTabs">
            <button class="marketTab active" data-tab="collections">Collections</button>
            <button class="marketTab" data-tab="nfts">All NFTs</button>
            <button class="marketTab" data-tab="auctions">Auctions</button>
        </div>

        <div class="marketTabContent">
            <div id="collectionsTab" class="tabPanel active"><div id="collectionsContainer" class="cardGrid"></div></div>
            <div id="nftsTab" class="tabPanel"><div id="nftsContainer" class="cardGrid"></div></div>
            <div id="auctionsTab" class="tabPanel"><div id="auctionsContainer" class="cardGrid"></div></div>
        </div>
    </div>
</section>
`;

    // EXHIBITION BUTTON
    document.getElementById("exhibitionBtn").addEventListener("click", () => {
         showExhibitions();
    });

    // FOLLOW BUTTON (NOW SAFE)
   const followBtn = document.getElementById("followBtn");

followBtn.addEventListener("click", async () => {
    const userId = localStorage.getItem("userId");
    const targetUserId = localStorage.getItem("artistId");

    const res = await fetch("https://changes-sample.onrender.com/api/follow", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ userId, targetUserId })
    });

    const data = await res.json();

    updateFollowButton(followBtn, data.following);
});

// ✅ CHECK FOLLOW STATUS ON LOAD
const userId = localStorage.getItem("userId");
// const artistId = localStorage.getItem("artistId");

if (userId && artistId) {
    checkFollowStatus(userId, artistId, followBtn);
}
    renderNFTs();
}


async function checkFollowStatus(userId, artistId, followBtn) {
    try {
        const res = await fetch(
            `https://changes-sample.onrender.com/api/follow-status?userId=${userId}&targetUserId=${artistId}`
        );

        if (!res.ok) return;

        const data = await res.json();

        updateFollowButton(followBtn, data.following);

    } catch (err) {
        console.error("Follow status check failed:", err);
    }
}

function updateFollowButton(button, isFollowing) {
    if (!button) return;

    if (isFollowing) {
        button.innerHTML = "♥ Following";
        button.classList.add("following");
    } else {
        button.innerHTML = "♡ Follow";
        button.classList.remove("following");
    }
}
let allExhibitions = []; // global

// 1️⃣ Fetch exhibitions when the page loads
async function loadExhibitions() {
    try {
        const res = await fetch('https://changes-sample.onrender.com/api/marketplace/exhibitions');
        if (!res.ok) throw new Error('Failed to fetch exhibitions');
        allExhibitions = await res.json();
    } catch (err) {
        console.error("Failed to load exhibitions:", err);
    }
}

// 2️⃣ Render exhibitions in a modal or container
function showExhibitions() {
    if (!allExhibitions.length) {
        alert("No exhibitions available at the moment");
        return;
    }

    // Example: render in a simple modal-like overlay
    let html = `
        <div class="exhibitionOverlay" style="
            position:fixed;top:0;left:0;width:100%;height:100%;
            background:rgba(0,0,0,0.8);display:flex;align-items:center;justify-content:center;
            overflow:auto;z-index:9999;
        ">
            <div class="exhibitionContent" style="background:#fff;padding:24px;border-radius:8px;max-width:800px;width:90%;">
                <button id="closeExhibition" style="float:right;font-size:18px;">✖</button>
                <h2>Exhibitions</h2>
                <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-top:16px;">
    `;

    allExhibitions.forEach(e => {
        html += `
            <div class="exhibitionCard" style="border:1px solid #ddd;border-radius:8px;overflow:hidden;">
                <img src="${e.thumbnailUrl || 'https://via.placeholder.com/400'}" alt="${e.title}" style="width:100%;height:150px;object-fit:cover;">
                <div style="padding:8px;">
                    <h4>${e.title || 'Untitled'}</h4>
                    <p style="font-size:12px;color:#666;">${e.description || 'No description'}</p>
                    <span style="font-size:12px;color:#333;">Start: ${new Date(e.startDate).toLocaleDateString()}</span>
                </div>
            </div>
        `;
    });

    html += `</div></div></div>`; // close grid & overlay

    // append overlay to body
    const div = document.createElement('div');
    div.innerHTML = html;
    document.body.appendChild(div);

    // close button
    document.getElementById("closeExhibition").addEventListener("click", () => {
        div.remove();
    });
}


/* ================= TABS ================= */
function setupTabs() {
    document.querySelectorAll('.marketTab').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('.marketTab').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tabPanel').forEach(p => p.classList.remove('active'));

            btn.classList.add('active');
            const tab = btn.dataset.tab;

            if (tab === 'collections') renderCollections();
            if (tab === 'nfts') renderNFTs();
            if (tab === 'auctions') renderAuctions();
            
            document.getElementById(tab + 'Tab').classList.add('active');
        });
    });
}

/* ================= COLLECTIONS ================= */
async function loadCollections() {
    const res = await fetch('https://changes-sample.onrender.com/api/marketplace/collections');
    if (!res.ok) throw new Error('Failed to fetch collections');
    allCollections = await res.json();
    mapNFTsToCollections();
}

function mapNFTsToCollections() {
    allCollections.forEach(col => {
        const nftsInCollection = allNFTs.filter(n => (n.collectionId?._id || n.collectionId) === col._id);
        collectionNFTImages[col._id] = nftsInCollection.map(n => n.imageUrl);
    });
}

function renderCollections() {
    const container = document.getElementById('collectionsContainer');
    if (!container) return;
    let html = '';
    allCollections.forEach(col => {
        const firstImg = collectionNFTImages[col._id]?.[0] || 'https://via.placeholder.com/400';
        html += `
            <div class="artworkCard" onclick="alert('Go to collection ${col._id}')">
                <div class="artworkImage" style="background-image:url('${firstImg}')"></div>
                <div class="artworkDetails">
                    <div class="artworkTitle">${col.name}</div>
                    <div class="artworkPrice">${collectionNFTImages[col._id]?.length || 0} items</div>
                </div>
            </div>
        `;
    });
    container.innerHTML = html;
}

/* ================= ALL NFTs ================= */
function renderNFTs() {
    const container = document.getElementById("nftsContainer");

    // artistNFTs is already filtered during loadArtistProfile()
    if (!artistNFTs || !artistNFTs.length) {
        container.innerHTML = `<div class="emptyState">No artworks found</div>`;
        return;
    }

    container.innerHTML = artistNFTs.map(nft => renderArtworkCard(nft)).join('');
}

function renderArtworkCard(nft) {
    const image = nft.imageUrl || 'https://via.placeholder.com/400';
    const title = nft.name || 'Untitled Artwork';
    const price = nft.price 
        ? `${Number(nft.price).toFixed(2)} ${nft.currency || 'SOL'}` 
        : 'Not listed';

    return `
        <div class="artworkCard" onclick="window.location.href='artwork.html?id=${nft._id}'">
            <div class="artworkImage" style="background-image:url('${image}')"></div>
            <div class="artworkDetails">
                <div class="artworkTitle">${title}</div>
                <div class="artworkPrice">${price}</div>
            </div>
        </div>
    `;
}


/* ================= AUCTIONS ================= */
async function loadAuctions() {
    const res = await fetch('https://changes-sample.onrender.com/api/marketplace/auctions');
    if (!res.ok) throw new Error('Failed to fetch auctions');
    allAuctions = await res.json();
    renderAuctions();
}

function renderAuctions() {
    const container = document.getElementById('auctionsContainer');
    if (!container) return;
    const now = new Date();

    let nftMap = {};
    allNFTs.forEach(nft => nftMap[nft._id] = nft);

    const activeAuctions = allAuctions.filter(a => new Date(a.startTime) <= now && new Date(a.endTime) > now);

    if (!activeAuctions.length) {
        container.innerHTML = '<div style="text-align:center;color:#9ca3af;padding:32px;">No live auctions at the moment</div>';
        return;
    }

    container.innerHTML = activeAuctions.map(a => {
        const nft = nftMap[a.nft] || {};
        const img = nft.imageUrl || 'https://via.placeholder.com/400';
        const t = getTimeLeft(new Date(a.endTime));

        return `
        <div class="artworkCard" id="auction-${a._id}" onclick="alert('Open auction ${a._id}')">
            <div class="artworkImage" style="background-image:url('${img}')"></div>
            <div class="artworkDetails">
                <div class="artworkTitle">${nft.name || a.title || 'Untitled'}</div>
                <div class="artworkPrice">Current Bid: ${a.currentBid || a.startingPrice} ${a.currency || 'ETH'}</div>
                <div>Time left: <span id="countdown-${a._id}">${t.hours}h ${t.minutes}m ${t.seconds}s</span></div>
            </div>
        </div>
        `;
    }).join('');

    // Start countdowns
    activeAuctions.forEach(a => startAuctionCountdown(a));
}

function startAuctionCountdown(a) {
    const countdownEl = document.getElementById(`countdown-${a._id}`);
    const endTime = new Date(a.endTime);

    const interval = setInterval(() => {
        const t = getTimeLeft(endTime);
        if (!countdownEl) { clearInterval(interval); return; }
        if (endTime - new Date() <= 0) {
            countdownEl.textContent = 'Ended';
            clearInterval(interval);
            return;
        }
        countdownEl.textContent = `${t.hours}h ${t.minutes}m ${t.seconds}s`;
    }, 1000);
}

function getTimeLeft(endTime) {
    const diff = Math.max(0, endTime - new Date());
    return {
        hours: Math.floor(diff / 1000 / 60 / 60),
        minutes: Math.floor((diff / 1000 / 60) % 60),
        seconds: Math.floor((diff / 1000) % 60)
    };
}

document.addEventListener("DOMContentLoaded", () => {
  loadArtistProfileAvatar();
});
</script>


</body>
</html>
